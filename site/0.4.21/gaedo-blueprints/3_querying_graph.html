<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Jan 29, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130129" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Gaedo blueprints backed services - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Gaedo blueprints backed services</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2013-01-29</li>
                      
                
                    
                 <li id="projectVersion" class="pull-right">Version: 0.4.21</li>
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">about gaedo-blueprints</li>
                                
      <li>
    
                          <a href="1_gaedo_graph_storage.html" title="An introduction to gaedo graph storage">
          <i class="none"></i>
        An introduction to gaedo graph storage</a>
            </li>
                  
      <li>
    
                          <a href="2_gaedo_generic_storage.html" title="Access to generic nodes">
          <i class="none"></i>
        Access to generic nodes</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Querying a graph</a>
          </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                              
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                              
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="$sitesearchValue" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <p>This document focuses on how queries are run on a graph managed by gaedo-blueprints. If one wants to have infos on specific features regarding graph queries, this is the right document. However, if one wants infos regarding how to write a query, regardless of the underlyin storage mechanism, or how dynamic finders are mapped on real <tt>QueryBuilder</tt>, general documentation of gaedo is better suited.</p><h1>How is a query performed on graph - a broad view</h1><p>To make things clear, explanations here are given in the best case, thats to say when <tt>StrategyType.beanBased</tt> is used. If the previous sentence has no meaning to you, it probably mean youre in that case, as the oppsite strategy (<tt>StrategyType.graphBased</tt>) is the non-default and should be selected by developper.</p><p>To make things simples, execution of a query on graph is quite simple and can be splitted in some easy steps</p>
<ol style="list-style-type: decimal">
  <li>Transform QueryExpression into a collection of VertexTest</li>
  <li>Choose some query roots from that collection of vertex and back-navigate to vertex corresponding to objects</li>
  <li>Perform all VertexTest on those vertices and, if they match all, add them to results iterable</li>
  <li>Browse results iterable and load objects on the fly</li>
</ol><p>Now, lets detail these elements on some sample queries. For all those example queries, we will suppose (like in <tt>GraphPostFinderServiceTest</tt>), we have a </p>
<div class="source"><pre class="prettyprint linenums">// a standard IndexableGraphBackedFinderService with StrategyType.beanBased
FinderCrudService&lt;Post, PostInformer&gt; service;
</pre></div><p>which will be used to perform those sample queries</p><h1>Find posts having a value</h1><div class="section"><h2>Find posts having a given literal value<a name="Find_posts_having_a_given_literal_value"></a></h2><p>First, lets start by a very simple example</p>
<div class="source"><pre class="prettyprint linenums">service.find().matching(new QueryBuilder() {
    public QueryExpression createMatchingExpression(PostInformer informer) {
       return informer.getNote().equalsTo(2.0f);
    }
}).getAll()
</pre></div><p>The goal of this query is quite simple (and it could also be expressed using this dynamic finder : <tt>findAllByNoteEqualsTo(2.0f)</tt> which has the known advantage of readability), so lets detail this behaviour.</p><p>First, <tt>QueryExpression</tt> is visited by a <tt>BluePrintsQueryBuilder</tt> which will construct a <tt>GraphExecutableQuery</tt> using the predicates given by the <tt>QueryExpression</tt>. As the GraphExecutableQuery has a nice toString(), lets use it to see how this query translates at the blueprints level : </p>
<div class="source"><pre class="prettyprint linenums">com.dooapp.gaedo.blueprints.queries.executable.OptimizedGraphExecutableQuery [
    test= AndVertexTest 
       note EqualsTo 2.0
       classes CollectionContains class com.dooapp.gaedo.test.beans.Post, 
sort=com.dooapp.gaedo.finders.sort.SortingExpressionImpl@47570945]
</pre></div><p>Well, the sorting expression is useless here (as you may now, this version not yet implements sorting in graph). Anyway, the test is quite clear. let me repeat it : </p>
<div class="source"><pre class="prettyprint linenums">test= AndVertexTest 
    note EqualsTo 2.0
    classes CollectionContains class com.dooapp.gaedo.test.beans.Post, 
</pre></div><p>This is quite clear : we look for objects having an edge named <tt>note</tt> having as value <tt>2.0</tt> and which <tt>classes</tt> collection contains <tt>com.dooapp.gaedo.test.beans.Post</tt> (a graphw ay to say target node can be casted to an instance of <tt>Post</tt>, no ?).</p><p>The graph can be big. <b>Really</b> big, I mean, so we clearly wont browse all vertices looking for the ones were searching. Hopefully, to avoid that (as the picture upper shows), properties are represented as edges. So were quite sure the results are linked to both the 2.0f literal and to the <tt>com.dooapp.gaedo.test.beans.Post</tt> literal. The ensemblist method would be here to intersect both sets. Unfortunatly, gaedo-blueprints does not yet provide such a feature. To emulate it, in a way, we check which of the set is the smallest, then test each of its elements for matching.</p><p>This way we obtain a list of vertices that will be loaded on iteration.</p><h1>Find posts having a given object value</h1><p>Now how to get posts written by a given author ? Suppose I have a <tt>User</tt> object (named <tt>user</tt>) obtained from a providential <tt>userService</tt>. To get all posts written by this author, its as simple as </p>
<div class="source"><pre class="prettyprint linenums">service.find().matching(new QueryBuilder() {
    public QueryExpression createMatchingExpression(PostInformer informer) {
       return informer.getAuthor().equalsTo(author);
    }
}).getAll()
</pre></div><p>Well, I give the dynamic query to you </p><p>Anyway, it translates as a GraphExecutableQuery which test is</p>
<div class="source"><pre class="prettyprint linenums">AndVertexTest 
    author EqualsTo com.dooapp.gaedo.test.beans.User@b4deeb1c
    classes CollectionContains class com.dooapp.gaedo.test.beans.Post
</pre></div><p>How is the <tt>author</tt> translated into a vertex you guess ? Well, the <tt>userService</tt> does the job and gives the query a root vertex to count edges on.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2013
                        <a href="www.dooapp.com">dooApp</a>.
            All Rights Reserved.      
                    
      </div>

        
        
          
    
    
                
    <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="http://www.ohloh.net/p/gaedo/widgets/project_factoids.js"></script>
    </div>
        </div>
    </footer>
  </body>
</html>
