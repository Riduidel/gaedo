<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Jan 29, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130129" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Gaedo - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Gaedo</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2013-01-29</li>
                      
                
                    
                 <li id="projectVersion" class="pull-right">Version: 0.4.21</li>
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">about gaedo</li>
                                
      <li>
    
                          <a href="1_the_gaedo_case.html" title="the gaedo case">
          <i class="none"></i>
        the gaedo case</a>
            </li>
                  
      <li>
    
                          <a href="2_gaedo_and_collection_storage.html" title="gaedo and collection storage">
          <i class="none"></i>
        gaedo and collection storage</a>
            </li>
                  
      <li>
    
                          <a href="3_method_missing_vs_invokeLater.html" title="method missing vs invokeLater">
          <i class="none"></i>
        method missing vs invokeLater</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>compilable queries a senseless concept</a>
          </li>
                  
      <li>
    
                          <a href="5_dynamic_finders_the_reference.html" title="dynamic finders the reference">
          <i class="none"></i>
        dynamic finders the reference</a>
            </li>
                  
      <li>
    
                          <a href="6_how_to_include_gaedo_in_my_application.html" title="how to include gaedo in my application">
          <i class="none"></i>
        how to include gaedo in my application</a>
            </li>
                  
      <li>
    
                          <a href="7_graphing_queries.html" title="graphing queries">
          <i class="none"></i>
        graphing queries</a>
            </li>
                  
      <li>
    
                          <a href="8_kudos_to_all_of_you.html" title="kudos to all of you">
          <i class="none"></i>
        kudos to all of you</a>
            </li>
                  
      <li>
    
                          <a href="9_gaedo_bug_in_bouncing_queries.html" title="gaedo bug in bouncing queries">
          <i class="none"></i>
        gaedo bug in bouncing queries</a>
            </li>
                  
      <li>
    
                          <a href="10_gaedo_does_graphs.html" title="gaedo does graphs">
          <i class="none"></i>
        gaedo does graphs</a>
            </li>
                              <li class="nav-header">other infos</li>
                                
      <li>
    
                          <a href="easy_release_with_maven.html" title="easy release with maven">
          <i class="none"></i>
        easy release with maven</a>
            </li>
                  
      <li>
    
                          <a href="gaedo_in_the_wild.html" title="gaedo in the wild">
          <i class="none"></i>
        gaedo in the wild</a>
            </li>
                  
      <li>
    
                          <a href="gaedo_supports_migrations.html" title="gaedo supports migrations">
          <i class="none"></i>
        gaedo supports migrations</a>
            </li>
                  
      <li>
    
                          <a href="guice_integration_is_ready.html" title="guice integration is ready">
          <i class="none"></i>
        guice integration is ready</a>
            </li>
                  
      <li>
    
                          <a href="prevalence_in_gaedo.html" title="prevalence in gaedo">
          <i class="none"></i>
        prevalence in gaedo</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                                                
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                            
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="$sitesearchValue" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <p>In presentation post, we shows out maybe too fast most prominent features of gaedo. </p><p>Between all those features, the most distinguishing is the astract query building mechanism.</p><p>Query API =========</p><p>Indeed, when Hibernate allows one to create a query <a class="externalLink" href="http://docs.jboss.org/hibernate/core/3.3/reference/en/html/querycriteria.html#querycriteria-examples">by example</a>, or by using <a class="externalLink" href="http://docs.jboss.org/hibernate/core/3.3/reference/en/html/queryhql.html">HQL</a>, or even a <a class="externalLink" href="http://docs.jboss.org/hibernate/core/3.3/reference/en/html/querycriteria.html">hibernate-specific criteria API</a> (which is very performant), we preferred for gaedo to use a query API that is back-end independant (or as far as possible). As a consequence, theorically, the same query can be run against a collection back-end or against a google datastore back-end. We find it rather cool. And the fact that these queries are fully compiled, making all query errors compile-time visible (like, as an example, using a GREATER THAN on a String), is even cooler to us ! </p><p>But how does it works ? </p><p>Suppose you have a application made of <tt>User</tt> and <tt>Post</tt> (like, say, this blog could be stored - its obviously not the case, but it could) like the ones used by <tt>gaedo-google-datastore</tt> : </p>
<div class="source"><pre class="prettyprint linenums">public class User {
    @Id
    public long id;

    private String login;

    public String getLogin() {
       return login;
    }

    public void setLogin(String login) {
       this.login = login;
    }

    public String password;

    public Collection&lt;Post&gt; posts = new LinkedList&lt;Post&gt;();
}
</pre></div><p>(dont focus on the public/private nightmare, its some test code allowing us to check our hypothesis)</p>
<div class="source"><pre class="prettyprint linenums">public class Post {
    @Id
    long id;

    public String text;
    public float note;
    public boolean test;

    public User author;

    public Map&lt;String, String&gt; annotations = new TreeMap&lt;String, String&gt;();
}
</pre></div><p>What we want is the ability to write queries like this (yes, its really the kind of code that designed our API) :</p>
<div class="source"><pre class="prettyprint linenums">    u = userService.find().matching(new QueryBuilder&lt;UserInformer&gt;() {

       @Override
       public QueryExpression createMatchingExpression(UserInformer object) {
         return object.getLogin().equalsTo(&quot;toto&quot;);
       }
    }).getFirst();
</pre></div><p>So, how does it works ? </p><h1>Query building blocks</h1><p>A query is made of some basic building blocks : </p>
<ul>
  <li>a matching expression</li>
  <li>a return type</li>
</ul><p>Matching expression -</p><p>For building the matching expression in a truly abstract fashion, we need to build a parsable syntactical tree. As a consequence, we cant write</p>
<div class="source"><pre class="prettyprint linenums">       public QueryExpression createMatchingExpression(User object) {
         // For the record, this code is just WRONG, don't copy/paste it without reading !!!
         return object.getLogin().equalsTo(&quot;toto&quot;);
       }
</pre></div><p>Without relying upon heavy code generation (like, as an example, creating dynamically, through <a class="externalLink" href="http://cglib.sourceforge.net/">cglib</a>, a subclass of <tt>User</tt> in which calls will be used to generate a syntactical tree). As a consequence, we made up the concept of <tt>FieldInformer</tt>/<tt>Informer</tt>. </p><p>FieldInformer -</p><p>A <tt>FieldInformer</tt> describes a Field and memorizes expression generated from this field. As an example, the <tt>FieldInformer</tt> root interface is as follows</p>
<div class="source"><pre class="prettyprint linenums">public interface FieldInformer {
    /**
     * Check if field is equals to value
     * 
     * @param value
     *            checked value
     * @return a query expression checking. A new one will be created each time.
     */
    public QueryExpression equalsTo(Object value);
}
</pre></div><p>Notice this is really a base interface. Implementors of this interface are left free (and are greatly encouraged) to add others QueryExpression building methods. Also notice that a QueryExpression is really what is seems : an expression, destined to be added to a query. As of now (february 2010), implementors of FieldInformer are : </p>
<ul>
<li>ObjectFieldInformer
<ul>
<li>StringFieldInformer</li>
<li>ComparableFieldInformer&lt;ComparableType&gt;
<ul>
<li>DateFieldInformer</li>
<li>DoubleFieldInformer</li>
<li>LongFieldInformer</li>
<li>BigDecimalFieldInformer</li>
</ul>
</li>
<li>The Informer interface 
<ul>
<li>BigIntegerFieldInformer </li>
</ul>
</li>
</ul>
</li>
</ul><p>Informer </p><p>The <tt>Informer</tt> interface is an extension to the <tt>FieldInformer</tt>, allowing one to compare an object to another using equalsTo <tt>QueryExpression</tt>, but also to access one objects fields, using its get method :</p>
<div class="source"><pre class="prettyprint linenums">public interface Informer&lt;Informed extends Object&gt; extends FieldInformer, FieldProjector&lt;Informed&gt; {
    /**
     * get field informer for one of the fields of current object
     * @param string
     * @return
     */
    FieldInformer get(String string);
}
</pre></div><p>This way, all fields can be accessed in the standardmost way : as simple FieldInformer. </p><p>Dynamic Informers </p><p>Thats rather boring ! Suppose I have, like in User, a login stored as String. To provide completion in login window (maybe not the most interesting use case), I would like to write something like </p>
<div class="source"><pre class="prettyprint linenums">       @Override
       public QueryExpression createMatchingExpression(Informer&lt;User&gt; object) {
         return object.get(&quot;login&quot;).startsWith(&quot;toto&quot;);
       }
</pre></div><p>which is totally possible, using a rather subtile trick. Indeed, one may have note this expression building uses <tt>Informer&lt;User&gt;</tt> instead of <tt>UserInformer</tt>. Well, here is the trick. Since this code will be rather frequent in your code, you dont have to write it ! Using a trick well explain later (suffice to say it involves <a class="externalLink" href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/reflect/Proxy.html">dynamic proxies</a>, and as a consequence is runtime-resolved), you only have to declare the following interface, and gaedo will do the whole work !</p>
<div class="source"><pre class="prettyprint linenums">public interface UserInformer extends Informer&lt;User&gt; {
    public StringFieldInformer getLogin();
    public StringFieldInformer getPassword();
}
</pre></div><p>using that interface, we finally can express our query as we want to :</p>
<div class="source"><pre class="prettyprint linenums">       @Override
       public QueryExpression createMatchingExpression(UserInformer object) {
         return object.getLogin().equalsTo(&quot;toto&quot;);
       }
</pre></div><p>Which is easier, no ? once our query is built, we want to get back some results. </p><p>Result fetching modes </p><p>Like in ay data storage mechanism, there are some way to retrieve results, which are all defined using an interface (youll soon start to get used to the multiplicity of interfaces of gaedo ;-)) :</p>
<div class="source"><pre class="prettyprint linenums">public interface QueryStatement&lt;DataType&gt; {
    DataType getFirst();
    Iterable&lt;DataType&gt; getAll();
    Iterable&lt;DataType&gt; get(int start, int end);
    int count();
}
</pre></div><p>This way, most common operations are possible. </p><p>Sorting : the missing fragment ==============================</p><p>yes, for now, custom sorting of results is not supported. That is a big miss (but honestly, since not very high on our priorities, it has not yet been implemented by pure lack of time). Just wait until issue #24 is marked as fixed ;-)</p>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2013
                        <a href="www.dooapp.com">dooApp</a>.
            All Rights Reserved.      
                    
      </div>

        
        
          
    
    
                
    <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="http://www.ohloh.net/p/gaedo/widgets/project_factoids.js"></script>
    </div>
        </div>
    </footer>
  </body>
</html>
